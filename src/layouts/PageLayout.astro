---
import Layout from "./Layout.astro";
import { Image, getImage } from "astro:assets";

// The props will come from frontmatter if we are targetting an *.md file
const props = Astro.props.frontmatter ?? Astro.props;
const { mainTitle, author, containerClass = "container" } = props;

import missionStatementHeader from "../images/mission-statement-header.jpg";
import incitationHeader from "../images/incitation-header.jpg";
import blogHeader from "../images/blog-header.jpg";
import sessionsHeader from "../images/sessions-header.jpg";
import faqHeader from "../images/faq-header.jpg";
import joinUsHeader from "../images/join-us-header.jpg";
import testimonialHeader from "../images/testimonials-header.jpg";

function getImageSrc(path) {
  if (path.match(/mission/)) {
    return missionStatementHeader.src;
  } else if (path.match(/incitation/)) {
    return incitationHeader.src;
  } else if (path.match(/blog/)) {
    return blogHeader.src;
  } else if (path.match(/sessions/)) {
    return sessionsHeader.src;
  } else if (path.match(/faq/)) {
    return faqHeader.src;
  } else if (path.match(/join/)) {
    return joinUsHeader.src;
  } else if (path.match(/testimonials/)) {
    return testimonialHeader.src;
  } else {
    return "";
  }
}

const src = getImageSrc(Astro.url.pathname);

// await getImage({ src: backgroundImage }).then(result => result.src);
// await /* @vite-ignore */ import(backgroundImage)
//   .then((src) => {
//     return getImage({
//       src: src.default,
//     });
//   })
//   .then((transformedImage) => transformedImage.src);
---

<Layout {...props}>
  <header style={{ backgroundImage: `url(${src})` }}>
    <div class="inner">
      <div class="container">
        <h1>{mainTitle}</h1>
        {
          author && (
            <div id="author">
              <Image
                src={author.picture}
                alt={`Profile picture of ${author.name}`}
                width={100}
                height={100}
                class="img-thumbnail"
              />
              <strong>{author.name}</strong>
            </div>
          )
        }
      </div>
    </div>
  </header>
  <main class="my-4">
    <div class={containerClass}>
      <slot />
    </div>
  </main>
</Layout>

<style lang="sass">
  @import "bootstrap/scss/functions"
  @import "bootstrap/scss/variables"
  @import "bootstrap/scss/mixins"

  header
    height: 200px
    background-size: cover
    background-position: 50%
    background-repeat: no-repeat
    color: $white
    position: relative

    .inner
      background-color: transparentize($dark, 0.5)
      position: relative
      z-index: 2
      height: 100%
      width: 100%
      padding: (4 * $spacer) 0

    @include media-breakpoint-up(md)
      height: 300px

    #author
      display: flex
      align-items: end
      flex-direction: column
      strong
        margin-top: $spacer
</style>
